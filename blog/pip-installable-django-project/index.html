<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="referrer" content="no-referrer">
    <meta name="author" content="toxinu" />
	<meta name="description" content="Developer, hacker, music listener and books reader.">

	<title>
	
	
	     Pip installable Django project 
	
	</title>
    <link rel="stylesheet" href="/css/style.css">
	
		<link href="" rel="feed" type="application/rss+xml" title="toxinu" />
	

    <link rel="icon" type="image/png" sizes="128x128"  href="/images/favicon.png">
    <meta name="theme-color" content="#ffffff">

    <script type="text/javascript" src="/js/script.js"></script>
</head>
<body>
    <div class="masthead grid">
        <div class="inline left">
            <a class="home" href="/">toxinu</a>
        </div>
        <ul class="inline right">
            <li><a href="/code">Code</a></li>
            <li><a href="/games">Games</a></li>
            <li><a href="/about">About</a></li>
        </ul>
    </div>

<div class="grid">
<h1>Pip installable Django project</h1>
    <span class="small">Posted on 16 December 2016</span>

    <div><p>I'll present you a <a href="https://www.djangoproject.com/">Django</a> layout which allow to ship your project (not app) as a <a href="https://www.python.org/">Python</a> package. Your users will be able to install it with <a href="https://pip.pypa.io/en/stable/">pip</a> for example.</p>
<p>This template is available as a <a href="https://cookiecutter.readthedocs.io/en/latest/">Cookiecutter</a> template. But I'll remove every references, because this paper is mainly written to present you a Django project layout. Maybe I'll do another post about Cookiecutter later.</p>
<p>My first need is to be able to install my Django project via <code>pip install my-awesome-app</code> and access it via <code>my-awesome-app</code> entry point
without losing <code>manage.py</code> flexibility.
The first reference for this template is <a href="https://github.com/getsentry/sentry">Sentry</a> project. I'm really appreciative of how this project is nicely built by nice people.</p>
<p>Let's describe how it works!</p>
<h2 id="layout">Layout</h2>
<p>This is a little description of my typical layout for every new Django project I build.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="ln"> 1</span>$ tree .
<span class="ln"> 2</span>.
<span class="ln"> 3</span>├── conftest.py
<span class="ln"> 4</span>├── Makefile
<span class="ln"> 5</span>├── MANIFEST.in
<span class="ln"> 6</span>├── README.rst
<span class="ln"> 7</span>├── setup.cfg
<span class="ln"> 8</span>├── setup.py
<span class="ln"> 9</span>├── src
<span class="ln">10</span>│   └── my_awesome_project
<span class="ln">11</span>│       ├── __about__.py
<span class="hl"><span class="ln">12</span>│       ├── apps
</span><span class="ln">13</span>│       │   ├── app_one
<span class="ln">14</span>│       │   └── app_two
<span class="hl"><span class="ln">15</span>│       ├── core
</span><span class="ln">16</span>│       │   ├── apps.py
<span class="ln">17</span>│       │   ├── views.py
<span class="ln">18</span>│       │   └── <span class="o">[</span>...<span class="o">]</span>
<span class="ln">19</span>│       ├── runner
<span class="ln">20</span>│       │   ├── commands
<span class="ln">21</span>│       │   │   ├── django.py
<span class="ln">22</span>│       │   │   └── help.py
<span class="ln">23</span>│       │   └── decorators.py
<span class="ln">24</span>│       ├── settings
<span class="hl"><span class="ln">25</span>│       │   ├── base.py
</span><span class="hl"><span class="ln">26</span>│       │   └── local.dist.py
</span><span class="ln">27</span>│       ├── urls.py
<span class="ln">28</span>│       └── wsgi.py
<span class="ln">29</span>└── tests
<span class="ln">30</span>    └── core
<span class="ln">31</span>        └── test_core.py</code></pre></div>
<p>In order to have a <a href="https://pip.pypa.io/en/stable/">pip</a> installable project we need to have a <code>setup.py</code> like every <a href="https://www.python.org/">Python</a> package.
You'll notive that we don't need <code>requirements.txt</code> at all. Hooray! All your dependencies will be organized in <code>setup.py</code>.
No more <code>requirements-[dev|test].txt</code> files, <a href="https://setuptools.readthedocs.io/en/latest/">setuptools</a> <code>extras_require</code> option will do the trick.</p>
<p>You'll probably need a <code>core</code> app (<em>line 15</em>) and many other apps (<em>line 12</em>). Another special directory is <code>runner</code> where your
command line entry points will be stored.</p>
<p>Django community have various ways to organize settings, feel free to use your own but I prefer to have a <code>base.py</code> (<em>line 25</em>) settings file and another <code>local.py</code> which will be imported in <code>settings/__init__.py</code>.</p>
<p>It's always a good thing to give users <code>local.dist.py</code> (<em>line 26</em>) or <code>production.dist.py</code> example files, as long as Django settings number always tend to grow.
Always try to put a little description below every settings that can be complex. But don't try to describe all them all if it seems easy to understand.
This kind of documentation can be difficult to keep up-to-date.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">https://localhost:8000/login</span><span class="s1">&#39;</span>
<span class="c1"># Set these to drop to an unprivileged user after</span>
<span class="c1"># binding the SMTP daemon (Default: False)</span>
<span class="n">DROP_PRIVILEGES_USER</span> <span class="o">=</span> <span class="bp">False</span>
<span class="c1"># Product name appear in email templates and optouts pages</span>
<span class="n">PRODUCT_NAME</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">My Awesome App</span><span class="s1">&#39;</span></code></pre></div>
<h2 id="install-process">Install process</h2>
<p>A developper install process will be something like that:</p>
<ul>
<li>Cloning repository</li>
<li>Build <a href="https://virtualenv.pypa.io/en/stable/">virtualenv</a></li>
<li><code>pip install -e .[dev,test]</code></li>
<li>Coding.</li>
</ul>
<p>A production deployment for a <a href="https://pypi.org/">PyPI</a> published project will be:</p>
<ul>
<li><code>pip install my-awesome-project</code></li>
<li>Run command line: <code>my-awesome-project --help</code></li>
</ul>
<p>Let's take a quick look at <code>setup.py</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="p">[</span><span class="o">.</span><span class="o">.</span><span class="o">.</span><span class="p">]</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="sa"></span><span class="s1">&#39;</span><span class="s1">console_scripts</span><span class="s1">&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">my-awesome-project = my_awesome_project.runner:main</span><span class="s1">&#39;</span><span class="p">]</span>
    <span class="p">}</span><span class="p">,</span>
    <span class="n">extras_require</span><span class="o">=</span><span class="p">{</span>
        <span class="sa"></span><span class="s1">&#39;</span><span class="s1">dev</span><span class="s1">&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">bumpversion==0.5.3</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">docker-compose==1.9.0</span><span class="s1">&#39;</span>
        <span class="p">]</span><span class="p">,</span>
        <span class="sa"></span><span class="s1">&#39;</span><span class="s1">tests</span><span class="s1">&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">pytest==3.0.5</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">flake8==3.2.1</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">libfaketime==0.4.2</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">factory-boy==2.7.0</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="sa"></span><span class="s1">&#39;</span><span class="s1">fake-factory==0.7.2</span><span class="s1">&#39;</span>
        <span class="p">]</span><span class="p">,</span>
    <span class="p">}</span><span class="p">,</span>
<span class="p">[</span><span class="o">.</span><span class="o">.</span><span class="o">.</span><span class="p">]</span></code></pre></div>
<p>This <code>extra_require</code> option is pretty useful. You can have a <code>production</code>
one which contains for example <a href="http://gunicorn.org/">Gunicorn</a> or <a href="http://initd.org/psycopg/docs/">Psycopg</a>, etc&hellip;</p>
<h2 id="where-is-my-managepy">Where is my <code>manage.py</code>?</h2>
<p>First of all, don't panic! You still have <code>django-admin</code> command line tool which is very similar to <code>manage.py</code>.</p>
<p>Instead of <code>python manage.py shell</code>, you can do:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">DJANGO_SETTINGS_MODULE</span><span class="o">=</span>my_awesome_project.settings django-admin shell</code></pre></div>
<p>Ok, it's very verbose. This is why this template give you another approach with <code>runner</code> which use <a href="http://click.pocoo.org/">click</a> library.</p>
<p>Main goal is to be able to do something like:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">my-awesome-project django shell</code></pre></div>
<p>Then every Django commands will be accessible. You can take a look at how it works <a href="https://github.com/toxinu/cookiecutter-django/blob/59daaaebe9c1828dfab1beb7f7c8a22c4376ce7b/%7B%7B%20cookiecutter.package_name%20%7D%7D/src/%7B%7B%20cookiecutter.module_name%20%7D%7D/runner/commands/django.py">here</a>.</p>
<p>This is a dead simple example of a custom command which return Django version.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="err">$</span> <span class="n">cat</span> <span class="n">src</span><span class="o">/</span><span class="n">my_awesome_project</span><span class="o">/</span><span class="n">runner</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">version</span><span class="o">.</span><span class="n">py</span>
<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">django</span>


<span class="nd">@click.command</span><span class="p">(</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="sa"></span><span class="s2">&#34;</span><span class="s2">Show Django version.</span><span class="s2">&#34;</span>
    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">Django {}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">django</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span><span class="p">)</span></code></pre></div>
<p>Then you'll be able to do:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ my-awesome-project version
Django 1.10.1</code></pre></div>
<h2 id="end">End</h2>
<p>I know every Django or project layouts can be personnal but here, I want
to show you how to ship a Django project in a professional way.</p>
<p>You can retrieve this template <a href="https://github.com/toxinu/cookiecutter-django/">here</a>.</p>
<p>Feel free to contact me for any questions, leave issue on <a href="https://github.com/toxinu/cookiecutter-django/blob/59daaaebe9c1828dfab1beb7f7c8a22c4376ce7b/%7B%7B%20cookiecutter.package_name%20%7D%7D/src/%7B%7B%20cookiecutter.module_name%20%7D%7D/runner/commands/django.py">Github</a>.</p>
<p>In further posts I'll speak about: &ldquo;<em>How to store package metadata</em>&quot;, &ldquo;<em>How to trash your unmaintainable fixtures</em>&rdquo; and more tools like <a href="https://github.com/peritus/bumpversion">bumpversion</a> and <a href="https://www.docker.com/products/docker-compose">docker-compose</a>.</p>
</div>
</div>
	<div class="footer grid ta">
		&copy; 2019 toxinu <small class="latest-update">(latest update at 2019-11-29 14:27:33 &#43;0100 CET)</small>
	</div>
	<script data-no-instant>InstantClick.init();</script>
</body>
</html>

